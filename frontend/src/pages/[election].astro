---
export const prerender = false;

import { type SanityDocument } from "@sanity/client";
import { sanityClient } from "sanity:client";
import { Election } from "../app/Election";
import Layout from "../layouts/Layout.astro";

const ELECTIONS_QUERY = `
   *[_type == "election" && slug == $slug][0] {
    title,
    slug,
    theses[] {
      text,
      subtitle
    }
  }
`;

const election = await sanityClient.fetch<SanityDocument>(ELECTIONS_QUERY, {
  slug: Astro.params.election,
});

if (!election) {
  return new Response("Not found", { status: 404 });
}
---

<Layout>
  <Election {...election} client:only />
</Layout>
